# 天气机器人优化说明

## 功能优化概述

本次优化主要添加了工作日、假期和节假日的智能判断功能，使提醒更加人性化。

## 新增功能

### 1. 工作日检查
- **仅在周一至周五发送普通提醒**
- 周末（周六、周日）自动跳过
- 减少了非工作时间的打扰

### 2. 假期管理
- 支持配置自定义假期期间
- 假期期间不发送任何提醒
- 柔性的假期配置方案

### 3. 节假日特色提醒
- 内置2024-2026年中国国家法定假日
- 节假日期间发送特色问候而非普通报告
- 包含节假日emoji和温馨提示

### 4. 智能提醒规则

#### 天气报告（SendDailyReport）
```
- 工作日 + 非假期 + 非节假日 → 发送天气报告
- 节假日 → 发送节假日特色问候
- 假期期间 → 不发送任何提醒
- 周末 → 不发送任何提醒
```

#### 下班提醒（SendOffWorkReminder）
```
- 工作日 + 非假期 + 非节假日 → 发送下班提醒
- 其他情况 → 不发送
```

## 配置说明

### 配置文件 (config/config.yaml)

```yaml
# 自定义假期配置
holidays:
  - name: "年假"
    start_date: "2025-03-01"
    end_date: "2025-03-05"
  - name: "培训"
    start_date: "2025-04-10"
    end_date: "2025-04-12"
```

**注意**：假期日期格式必须为 `YYYY-MM-DD`

## 内置节假日列表

系统内置了以下国家法定假日（2024-2026年）：

| 假日 | 日期 | 特色问候 |
|------|------|--------|
| 元旦 | 1月1日 | 🎉 新年快乐！ |
| 春节 | 农历新年期间 | 🧧 春节快乐！恭喜发财！ |
| 清明节 | 4月4-6日 | 🌿 清明节安康！ |
| 劳动节 | 5月1-5日 | 💪 劳动节快乐！ |
| 端午节 | 农历五月初五 | 🐉 端午节快乐！ |
| 中秋节 | 农历八月十五 | 🌕 中秋节快乐！ |
| 国庆节 | 10月1-7日 | 🎊 国庆节快乐！ |

## 新增模块

### holiday/holiday.go

提供以下主要函数：

```go
// 检查是否为工作日（周一-周五）
IsWorkday(t time.Time) bool

// 检查是否在假期期间
IsHoliday(t time.Time, holidays []Holiday) bool

// 检查是否为节假日，返回节假日信息
IsFestival(t time.Time) (bool, *Festival)

// 检查是否应该发送天气报告提醒
ShouldSendReminder(holidays []Holiday) (bool, bool, *Festival)

// 检查是否应该发送下班提醒
ShouldSendOffWorkReminder(holidays []Holiday) (bool, bool, *Festival)
```

## 修改的文件

1. **internal/holiday/holiday.go** - 新建
   - 假期判断逻辑
   - 内置节假日数据

2. **internal/holiday/holiday_test.go** - 新建
   - 单元测试

3. **internal/config/config.go** - 修改
   - 添加 Holiday 结构体
   - 添加 Holidays 字段支持

4. **internal/cronn/cron.go** - 修改
   - 导入 holiday 包
   - SendDailyReport 添加工作日检查
   - SendOffWorkReminder 添加工作日检查

5. **config/config.yaml** - 修改
   - 添加 holidays 配置示例

## 使用示例

### 场景1：配置年假
```yaml
holidays:
  - name: "年假"
    start_date: "2025-03-01"
    end_date: "2025-03-05"
```
**效果**：2025年3月1-5日期间不发送任何提醒

### 场景2：自动节假日处理
节假日期间（如春节2025-02-01），系统会自动发送：
```
🧧 春节快乐！祝大家新春快乐，恭喜发财！

除夕至初六期间天气报告已暂停，假期结束后继续为您服务。
```

### 场景3：正常工作日
周一至周五，非假期、非节假日时：
- 早上8点发送天气报告
- 下午18点发送下班提醒

### 场景4：周末
周六、周日，自动跳过所有提醒

## 测试

运行单元测试：
```bash
go test -v ./internal/holiday
```

## 注意事项

1. 假期日期范围是包含的（startDate 到 endDate 都不发送）
2. 节假日优先级高于工作日判断
3. 自定义假期优先级高于内置节假日
4. 时区已设置为中国标准时间（GMT+8）
5. 建议定期更新YAML配置中的节假日信息

## 后续建议

1. 可以将节假日数据从外部API加载
2. 考虑支持加班补班的日期配置
3. 可以针对不同部门设置不同的假期规则
